<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Encuestas</title>
    <style>
        h2 {
            text-align: center;
            font-weight: lighter;
        }
        table {
            width: fit-content;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 5px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        tr:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }
        .form-group {
            background-color: darkgray;
            margin-bottom: 15px;
        }
        .container {
            display: flex;
        }
        .containerGraph {
            text-align: center;
            border-color: black;
            width: 250px;
            margin-top: 15px;
        }
        .centrar {
            text-align: center;
        }
        .formGraph {
            flex-direction: row;
            margin-left: 5px;
        }
        .form-container {
            display: flex;
            flex-direction: row;
            gap: 5px;
            margin-left: 20px;
            margin-right: 20px;
            margin-top: 20px;
        }
        button {
            cursor: pointer;
        }
        .input-error {
            border: 2px solid red;
            background-color: #ffe6e6;
        }
    </style>
</head>
<body>
    <div class="centrar">
        <h1>Usuarios para aplicar encuesta</h1>
        <input type="text" id="nombreUsuario" placeholder="Selecciona un usuario">
    </div>
    <div class="container">
        <!--<input type="text" id="nombreUsuario" placeholder="Selecciona un usuario" readonly> -->
        <table id="tablaUsuarios">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- Contenedor de Formularios -->
        <div class="form-container">
            <!-- Formulario de Encuesta 1-->
            <form id="surveyForm1">
                <h2>Encuesta 1</h2>
                <div class="form-group">
                    <label>¿Cómo calificaría nuestro servicio? (1 a 5)</label>
                    <input type="number" id="serviceRating" min="1" max="5" required>
                </div>
                <div class="form-group">
                    <label>¿Recomendaría nuestro producto a otros?</label>
                    <select id="recommend" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Sí">Sí</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>¿En que color le gusta el producto?</label>
                    <select id="color" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Blanco">Blanco</option>
                        <option value="Negro">Negro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>¿Qué tan satisfecho está con la atención al cliente? (1 a 5)</label>
                    <input type="number" id="satisfaction" min="1" max="5" required>
                </div>
                <div class="form-group">
                    <label>¿Con qué frecuencia usa nuestro producto?</label>
                    <select id="frequency" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Diario">Diario</option>
                        <option value="Semanal">Semanal</option>
                        <option value="Mensual">Mensual</option>
                        <option value="Rara vez">Rara vez</option>
                    </select>
                </div>
            </form>

            <!-- Formulario de Encuesta 2-->
            <form id="surveyForm2">
                <h2>Encuesta 2</h2>
                <div class="form-group">
                    <label>¿Qué tan satisfecho(a) estás con la atención al cliente que recibiste durante tu visita? (1 a 5)</label>
                    <input type="number" id="serviceRating2" min="1" max="5" required>
                </div>
                <div class="form-group">
                    <label>¿Cómo calificarías la limpieza y organización de la tienda?</label>
                    <select id="frequency2" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Excelente">Excelente</option>
                        <option value="Buena">Buena</option>
                        <option value="Regular">Regular</option>
                        <option value="Mala">Mala</option>
                        <option value="Muy Mala">Muy Mala</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>¿Recomendaría nuestro producto a otros?</label>
                    <select id="recommend2" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Sí">Sí</option>
                        <option value="Solo">Solo algunos productos</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>¿Qué tan satisfecho(a) estás con la relación calidad-precio de los productos que compraste? (1 a 5)</label>
                    <input type="number" id="satisfaction2" min="1" max="5" required>
                </div>
                <div class="form-group">
                    <label>¿Volverías a comprar en esta tienda?</label>
                    <select id="volver2" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Sí">Sí</option>
                        <option value="Solo">No estoy seguro</option>
                        <option value="No">No</option>
                    </select>
                </div>
            </form>

            <!-- Formulario de Encuesta 3-->
            <form id="surveyForm3">
                <h2>Encuesta 3</h2>
                <div class="form-group">
                    <label>¿Qué tan satisfecho(a) estás con la calidad de los alimentos que consumiste? (1 a 5)</label>
                    <input type="number" id="serviceRating3" min="1" max="5" required>
                </div>
                <div class="form-group">
                    <label>¿Cómo calificarías la atención que recibiste por parte del personal?</label>
                    <select id="frequency3" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Excelente">Excelente</option>
                        <option value="Buena">Buena</option>
                        <option value="Regular">Regular</option>
                        <option value="Mala">Mala</option>
                        <option value="Muy Mala">Muy Mala</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>¿El tiempo de espera para recibir tu pedido fue adecuado?</label>
                    <select id="recommend3" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Sí">Sí</option>
                        <option value="Solo">No, fue un poco lento</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>¿Qué tan satisfecho(a) estás con la relación calidad-precio de tu experiencia en el restaurante? (1 a 5)</label>
                    <input type="number" id="satisfaction3" min="1" max="5" required>
                </div>
                <div class="form-group">
                    <label>¿Recomendarías este restaurante a familiares y amigos?</label>
                    <select id="volver3" required>
                        <option value="">Seleccione una opción</option>
                        <option value="Sí">Sí</option>
                        <option value="Solo">No estoy seguro</option>
                        <option value="No">No</option>
                    </select>
                </div>
            </form>
        </div>
    </div>

    <div class="centrar">
        <h2>Guardar las repuestas del Usuario</h2>
        <button type="button" onclick="enviarRespuestas()">Enviar Encuestas</button>
    </div>

    <div class="centrar">
        <h2>Generar Gráfica por Usuario</h2>
        <select id="usuarioSelector">
            <option value="">Seleccione un usuario</option>
        </select>
        <button onclick="generarGraficas()">Generar Gráficas</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div class="container">
        <form class="formGraph">
            <div class="containerGraph">
                <label>Gráfica de Encuesta 1</label>
                <canvas id="graficaEncuesta1"></canvas>
            </div>
        </form>
        <form class="formGraph">
            <div class="containerGraph">
                <label>Gráfica de Encuesta 2</label>
                <canvas id="graficaEncuesta2"></canvas>
            </div>
        </form>
        <form class="formGraph"></form>
            <div class="containerGraph">
                <label>Gráfica de Encuesta 3</label>
                <canvas id="graficaEncuesta3"></canvas>
            </div>
        </form>
    </div>


    <script>
        // Definiciónn de la matriz para almacenar respuestas de usuarios
        const matrizRespuestas = [];
        
        // Función para obtener usuarios de la API
        async function obtenerUsuarios() {
            try {
                const respuesta = await fetch('https://jsonplaceholder.typicode.com/users');
                const usuarios = await respuesta.json();
                verUsuarios(usuarios);
            } catch (error) {
                console.error('Error al obtener los usuarios:', error);
            }
        }

        // Función para visualizar los usuarios en una tabla
        function verUsuarios(usuarios) {
            const tablaCuerpo = document.querySelector('#tablaUsuarios tbody');
            tablaCuerpo.innerHTML = ''; // Limpiar tabla antes de llenarla

            usuarios.forEach(usuario => {
                const fila = document.createElement('tr');

                fila.innerHTML = `
                    <td>${usuario.id}</td>
                    <td class="nombre">${usuario.name}</td>
                `;

                // Evento click en la fila del nombre
                fila.querySelector('.nombre').addEventListener('click', () => {
                    document.getElementById('nombreUsuario').value = usuario.name;
                });

                tablaCuerpo.appendChild(fila);
            });
        }
        
        // Valida que el numero ingresado sea entre 1 y 5
        function validarNumero(input) {
            const regex = /^[1-5]$/;
            if (!regex.test(input.value)) {
                // Mostrar mensaje de error o resaltar el campo
                input.classList.add("input-error");
                alert(`El valor ingresado "${input.value}" no es válido. Ingresa un número entre 1 y 5.`);
                return;
                input.focus(); // Devuelve el foco al input si no es válido
            } else {
                input.classList.remove("input-error"); // Limpia el error si es válido
            }
        }
        // Asigna el evento "blur" a los inputs de tipo "number"
         document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('blur', () => validarNumero(input));
        });

        // Función para validar las respuestas en las encuestas
        function validarEncuestas(encuestaId) {
            const form = document.getElementById(encuestaId);
            const inputs = form.querySelectorAll('input, select');

            for (let input of inputs) {
                if (!input.value) {
                    alert(`Por favor, responde todas las preguntas en la ${form.querySelector('h2').innerText}.`);
                    return false;
                }
            }
            return true;

        }

        // Función para enviar validar y guardar respuestas en la matriz
        function enviarRespuestas() {
            const nombreUsuario = document.getElementById('nombreUsuario').value;        

            //Validar que se elija un nombre de usuario
            if (!nombreUsuario) {
                alert("Por favor, elije un nombre de Usuario de la lista");
                return;
            }

            // Validar uqe las encuestas tengan un valor
            if (!validarEncuestas('surveyForm1') || !validarEncuestas('surveyForm2') || !validarEncuestas('surveyForm3')) {
                return;
            }
            

            // Crear un objeto con las respuestas del usuario
            const respuestas = {
                nombreUsuario: nombreUsuario,
                encuesta1: {
                    serviceRating: document.getElementById('serviceRating').value,
                    recommend: document.getElementById('recommend').value,
                    color: document.getElementById('color').value,
                    satisfaction: document.getElementById('satisfaction').value,
                    frequency: document.getElementById('frequency').value
                },
                encuesta2: {
                    serviceRating2: document.getElementById('serviceRating2').value,
                    frequency2: document.getElementById('frequency2').value,
                    recommend2 : document.getElementById('recommend2').value,
                    satisfaction2: document.getElementById('satisfaction2').value,
                    volver2: document.getElementById('volver2').value
                },
                encuesta3: {
                    serviceRating3: document.getElementById('serviceRating3').value,
                    frequency3: document.getElementById('frequency3').value,
                    recommend3 : document.getElementById('recommend3').value,
                    satisfaction3: document.getElementById('satisfaction3').value,
                    volver3: document.getElementById('volver3').value
                }
                
            };

            // Almacenar la respuesta en el arreglo
            matrizRespuestas.push(respuestas);
            console.log(matrizRespuestas);

            // Limpiar las encuestas
            document.querySelectorAll('form').forEach(form=>form.reset());

            // Mostrar agradecimiento y estadísticas
            alert("Gracias por completar las encuestas.");

            // Agregar nombres al selector
            const usuarioSelector = document.getElementById('usuarioSelector');
            const option = document.createElement('option');
            option.value = nombreUsuario;
            option.textContent = nombreUsuario;
            usuarioSelector.appendChild(option);
            document.getElementById('nombreUsuario').value = "";
        }

        function generarGraficas() {
            const usuarioSeleccionado = document.getElementById('usuarioSelector').value;

            if (!usuarioSeleccionado) {
                alert("Por favor, seleccione un usuario para generar las gráficas.");
                return;
            }

            // Buscar las respuestas del usuario en la matrizRespuestas
            const respuestasUsuario = matrizRespuestas.find(
                respuesta => respuesta.nombreUsuario === usuarioSeleccionado
            );

            if (!respuestasUsuario) {
                alert("No hay datos de encuestas para el usuario seleccionado.");
                return;
            }

            // Configurar los datos para las gráficas
            const datosEncuesta1 = [
                respuestasUsuario.encuesta1.serviceRating,
                respuestasUsuario.encuesta1.satisfaction
            ];
            const datosEncuesta2 = [
                respuestasUsuario.encuesta2.serviceRating2,
                respuestasUsuario.encuesta2.satisfaction2
            ];
            const datosEncuesta3 = [
                respuestasUsuario.encuesta3.serviceRating3,
                respuestasUsuario.encuesta3.satisfaction3
            ];

            // Crear gráfica para Encuesta 1
            new Chart(document.getElementById('graficaEncuesta1').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: ['Calificación de Servicio', 'Satisfacción'],
                    datasets: [{
                        data: datosEncuesta1,
                        backgroundColor: ['#FF6384', '#36A2EB']
                    }]
                },
                options: { responsive: true }
            });

            // Crear gráfica para Encuesta 2
            new Chart(document.getElementById('graficaEncuesta2').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: ['Satisfacción Atención', 'Calidad-precio'],
                    datasets: [{
                        data: datosEncuesta2,
                        backgroundColor: ['#FFCE56', '#4BC0C0']
                    }]
                },
                options: { responsive: true }
            });

            // Crear gráfica para Encuesta 3
            new Chart(document.getElementById('graficaEncuesta3').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: ['Satisfacción Calidad', 'Satisfacción General'],
                    datasets: [{
                        data: datosEncuesta3,
                        backgroundColor: ['#9966FF', '#FF9F40']
                    }]
                },
                options: { responsive: true }
            });
        }
        // Llamar a la función para cargar usuarios al iniciar la página
        obtenerUsuarios();
    </script>
</body>
</html>