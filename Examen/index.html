<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Gastos Mensuales</title>
    <style>
       body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f7f9fc;
    color: #333;
}

h1, h2, h3 {
    color: #0044cc;
    text-align: center;
}

#inicio, #app, #divformulario {
    max-width: 800px;
    margin: 20px auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

button {
    background-color: #0044cc;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    margin-right: 10px;
}

button:hover {
    background-color: #003399;
}

input, select {
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin: 5px 0;
    width: calc(100% - 20px);
}

#usuario-select, #presupuesto {
    max-width: 200px;
    display: inline-block;
}

table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
}

table caption {
    font-weight: bold;
    font-size: 16px;
    margin-bottom: 10px;
    color: #555;
}

th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

th {
    background-color: #f0f0f0;
    color: #333;
    text-transform: uppercase;
}

td {
    background-color: #fff;
}

#overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    z-index: 1000;
}

#divformulario {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    width: 90%;
    max-width: 400px;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    z-index: 1100;
}

#resultados {
    margin-top: 20px;
    padding: 20px;
    background: #f7f9fc;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
}

#resultados p {
    margin: 10px 0;
    font-size: 16px;
}

    </style>
</head>
<body>

<div id="inicio">
    <h2>Calculadora de Gastos</h2>
    <label for="usuario-select">Selecciona un usuario:</label>
    <select id="usuario-select" onchange="cambiarUsuario()">
        <option value="">Selecciona...</option>
    </select>

    <label for="presupuesto">Presupuesto:</label>
    <input type="number" id="presupuesto" placeholder="Ingresa tu presupuesto">
    <button onclick="establecerPresupuesto()">Establecer</button>
</div>

<div id="app" style="display: none;">
    <h1>Gastos Mensuales</h1>
    <button onclick="mostrarFormulario()">Agregar Gasto</button>
    <button onclick="calcularTotalGeneral()">Calcular Total General</button>
    <button onclick="calcularProductosMasConsumidos()">Productos Más Consumidos</button>

    <div id="tablas-container"></div>

    <div id="resultados">
        <p id="total-general">Total general: $0.00</p>
        <p id="presupuesto-restante">Presupuesto restante: $0.00</p>
        <p id="productos-mas-consumidos">Productos más consumidos: Ninguno aún</p>
    </div>
</div>

<div id="overlay" onclick="cerrarFormulario()"></div>

<div id="divformulario" style="display: none;">
    <form id="gastos">
        <h3>Agregar Gasto</h3>
        <p>Mes:</p>
        <select id="mes">
            <option value="enero">Enero</option>
            <option value="febrero">Febrero</option>
            <option value="marzo">Marzo</option>
            <option value="abril">Abril</option>
            <option value="mayo">Mayo</option>
            <option value="junio">Junio</option>
            <option value="julio">Julio</option>
            <option value="agosto">Agosto</option>
            <option value="septiembre">Septiembre</option>
            <option value="octubre">Octubre</option>
            <option value="noviembre">Noviembre</option>
            <option vlaue="diciembre">Diciembre</option>
            <!-- Continúa para los 12 meses -->
        </select>
        <p>Concepto:</p>
        <input type="text" id="concepto" placeholder="Ingresa el concepto">
        <p>Precio:</p>
        <input type="number" id="precio" placeholder="Ingresa el gasto">
        <div style="margin-top: 10px;">
            <button type="button" onclick="guardarGasto()">Guardar</button>
            <button type="button" onclick="cerrarFormulario()">Cancelar</button>
        </div>
    </form>
</div>

<script>
    let usuarios = [];
    let usuarioActual = null;
    let presupuesto = 0;
    let totalGeneral = 0;

    async function obtenerUsuarios() {
        try {
            const response = await fetch('https://jsonplaceholder.typicode.com/users');
            usuarios = await response.json();
            const selectUsuario = document.getElementById("usuario-select");
            usuarios.forEach(user => {
                const option = document.createElement("option");
                option.value = user.id;
                option.textContent = user.name;
                selectUsuario.appendChild(option);
            });
        } catch (error) {
            console.error("Error al obtener los usuarios:", error);
        }
    }
    obtenerUsuarios();

    function cambiarUsuario() {
        const select = document.getElementById("usuario-select");
        const userId = parseInt(select.value);
        usuarioActual = usuarios.find(user => user.id === userId);
        if (usuarioActual) {
            document.getElementById("app").style.display = "block";
            document.getElementById("tablas-container").innerHTML = "";
            totalGeneral = 0;
            actualizarTotales();
        }
    }

    function establecerPresupuesto() {
        const inputPresupuesto = document.getElementById("presupuesto");
        presupuesto = parseFloat(inputPresupuesto.value);
        if (isNaN(presupuesto) || presupuesto <= 0) {
            alert("Por favor, ingresa un presupuesto válido.");
        } else {
            actualizarTotales();
        }
    }

    function mostrarFormulario() {
        document.getElementById("overlay").style.display = "block";
        document.getElementById("divformulario").style.display = "block";
    }

    function cerrarFormulario() {
        document.getElementById("overlay").style.display = "none";
        document.getElementById("divformulario").style.display = "none";
    }

    function guardarGasto() {
        const concepto = document.getElementById("concepto").value.trim();
        const precio = parseFloat(document.getElementById("precio").value.trim());
        const mes = document.getElementById("mes").value;

        if (concepto && !isNaN(precio)) {
            const tablasContainer = document.getElementById("tablas-container");
            let tablaMes = document.getElementById(`tabla-${mes}`);
            if (!tablaMes) {
                tablaMes = document.createElement("table");
                tablaMes.id = `tabla-${mes}`;
                tablaMes.innerHTML = `
                    <caption>Gastos de ${mes.charAt(0).toUpperCase() + mes.slice(1)}</caption>
                    <thead>
                        <tr>
                            <th>Concepto</th>
                            <th>Precio</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                `;
                tablasContainer.appendChild(tablaMes);
            }

            const tablaBody = tablaMes.querySelector("tbody");
            const fila = document.createElement("tr");
            fila.innerHTML = `<td>${concepto}</td><td>${precio.toFixed(2)}</td>`;
            tablaBody.appendChild(fila);

            totalGeneral += precio;
            actualizarTotales();
            cerrarFormulario();
        } else {
            alert("Por favor, llena todos los campos correctamente.");
        }
    }

    function actualizarTotales() {
        document.getElementById("total-general").textContent = `Total general: $${totalGeneral.toFixed(2)}`;
        const restante = presupuesto - totalGeneral;
        document.getElementById("presupuesto-restante").textContent = `Presupuesto restante: $${restante.toFixed(2)}`;
        if (restante < 0) {
            alert("¡Has excedido el presupuesto!");
        }
    }

    function calcularProductosMasConsumidos() {
        const tablas = document.querySelectorAll("#tablas-container table");
        const conteo = {};

        tablas.forEach(tabla => {
            const filas = tabla.querySelectorAll("tbody tr");
            filas.forEach(fila => {
                const concepto = fila.cells[0].textContent;
                conteo[concepto] = (conteo[concepto] || 0) + 1;
            });
        });

        const maxConsumido = Math.max(...Object.values(conteo));
        const productosMasConsumidos = Object.keys(conteo).filter(
            concepto => conteo[concepto] === maxConsumido
        );

        document.getElementById("productos-mas-consumidos").textContent =
            productosMasConsumidos.length > 0
                ? `Productos más consumidos: ${productosMasConsumidos.join(", ")}`
                : "No hay datos suficientes.";
    }
</script>

</body>
</html>
